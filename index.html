<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¦• DINO RUSH</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background:#0a0a1a;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      min-height:100vh;
      font-family:'Courier New',monospace;
      overflow:hidden;
    }
    canvas {
      display:block;
      max-width:100%;
      border-radius:16px;
      image-rendering:pixelated;
      box-shadow:0 0 60px rgba(76,175,80,0.2), 0 30px 80px rgba(0,0,0,0.8);
    }
    #hint { color:#444; margin-top:12px; font-size:0.8em; letter-spacing:2px; }
  </style>
</head>
<body>
<canvas id="c"></canvas>
<p id="hint">SPACE Â· CLICK Â· TOUCH â€” JUMP</p>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const C  = document.getElementById('c');
const cx = C.getContext('2d');
C.width  = 860;
C.height = 320;

const GY = 268; // ground y

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUDIO ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let AC = null;
function getAC() {
  if (!AC) AC = new (window.AudioContext || window.webkitAudioContext)();
  return AC;
}
function beep(freq, dur, type='sine', vol=0.18, freqEnd=null) {
  try {
    const ac  = getAC();
    const osc = ac.createOscillator();
    const g   = ac.createGain();
    osc.connect(g); g.connect(ac.destination);
    osc.type = type;
    osc.frequency.setValueAtTime(freq, ac.currentTime);
    if (freqEnd) osc.frequency.linearRampToValueAtTime(freqEnd, ac.currentTime + dur);
    g.gain.setValueAtTime(vol, ac.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, ac.currentTime + dur);
    osc.start(); osc.stop(ac.currentTime + dur);
  } catch(e) {}
}
const SFX = {
  jump()    { beep(320, 0.12, 'sine', 0.15, 520); },
  land()    { beep(80,  0.08, 'triangle', 0.25); },
  score()   { beep(880, 0.08, 'sine', 0.12); setTimeout(()=>beep(1100,0.07,'sine',0.1),60); },
  combo()   { beep(660,0.07,'sine',0.13); setTimeout(()=>beep(880,0.07,'sine',0.12),80); setTimeout(()=>beep(1100,0.1,'sine',0.14),160); },
  hit()     { beep(120, 0.15, 'sawtooth', 0.3, 60); },
  over()    { beep(440,0.15,'sine',0.2); setTimeout(()=>beep(330,0.15,'sine',0.18),180); setTimeout(()=>beep(220,0.25,'sine',0.16),360); },
  levelup() { [523,659,784,1047].forEach((f,i)=>setTimeout(()=>beep(f,0.12,'sine',0.15),i*90)); }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PARTICLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let particles = [];
function addParticles(x, y, count, colors, vxRange, vyRange, life=40, size=3, gravity=0.15) {
  for (let i=0; i<count; i++) {
    particles.push({
      x, y,
      vx: (Math.random()-0.5)*vxRange,
      vy: -Math.random()*vyRange,
      life, maxLife:life,
      color: colors[Math.floor(Math.random()*colors.length)],
      size: size*(0.5+Math.random()),
      gravity
    });
  }
}
function dustPuff(x,y)   { addParticles(x,y,8,['#c8b89a','#a89070','#d4c4a8'],4,3,35,4,0.12); }
function scorePop(x,y)   { addParticles(x,y,10,['#FFD740','#FFEB3B','#FFF176','#fff'],5,5,45,3,0.08); }
function rockDebris(x,y) { addParticles(x,y,14,['#90A4AE','#78909C','#B0BEC5','#546E7A'],7,6,50,5,0.2); }
function updateParticles() {
  for (let i=particles.length-1;i>=0;i--) {
    const p=particles[i];
    p.x+=p.vx; p.y+=p.vy; p.vy+=p.gravity; p.life--;
    if(p.life<=0) particles.splice(i,1);
  }
}
function drawParticles() {
  particles.forEach(p=>{
    const a=p.life/p.maxLife;
    cx.globalAlpha=a;
    cx.fillStyle=p.color;
    cx.fillRect(p.x-p.size/2, p.y-p.size/2, p.size, p.size);
  });
  cx.globalAlpha=1;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FLOATING TEXT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let floats = [];
function addFloat(x,y,text,color='#FFD740',size=22) {
  floats.push({x,y,text,color,size,life:55,maxLife:55,vy:-1.2});
}
function updateFloats() {
  for(let i=floats.length-1;i>=0;i--) {
    floats[i].y+=floats[i].vy; floats[i].life--;
    if(floats[i].life<=0) floats.splice(i,1);
  }
}
function drawFloats() {
  floats.forEach(f=>{
    const a=Math.min(1, f.life/f.maxLife * 2);
    cx.globalAlpha=a;
    cx.fillStyle=f.color;
    cx.font=`bold ${f.size}px "Courier New"`;
    cx.textAlign='center';
    cx.fillText(f.text,f.x,f.y);
  });
  cx.globalAlpha=1; cx.textAlign='left';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCREEN EFFECTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let shake={x:0,y:0,t:0};
function doShake(intensity=6,frames=12){ shake.intensity=intensity; shake.t=frames; }
function updateShake(){
  if(shake.t>0){ shake.x=(Math.random()-0.5)*shake.intensity; shake.y=(Math.random()-0.5)*shake.intensity; shake.t--; shake.intensity*=0.85; }
  else { shake.x=0; shake.y=0; }
}

let flash={a:0};
function doFlash(a=0.5){ flash.a=a; }
function updateFlash(){ if(flash.a>0) flash.a=Math.max(0,flash.a-0.04); }

// Banner
let banner={text:'',a:0,scale:1,timer:0};
function showBanner(text){ banner.text=text; banner.a=1; banner.scale=1.4; banner.timer=90; }
function updateBanner(){
  if(banner.timer>0){ banner.timer--; banner.scale=Math.max(1,banner.scale-0.02); if(banner.timer<30) banner.a=banner.timer/30; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BACKGROUND â€” PARALLAX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Sky colors per time-of-day
const SKIES = [
  {top:'#FF8C42',bot:'#FFD166'},  // dawn   0-19
  {top:'#2196F3',bot:'#B3E5FC'},  // day    20-39
  {top:'#FF6B6B',bot:'#FFD93D'},  // sunset 40-59
  {top:'#0d0d2b',bot:'#1a1a4e'},  // night  60+
];
function getSkyColors(score){
  if(score<20) return SKIES[0];
  if(score<40) return SKIES[1];
  if(score<60) return SKIES[2];
  return SKIES[3];
}

// Stars
const stars = Array.from({length:80},()=>({
  x:Math.random()*C.width, y:Math.random()*(GY*0.7),
  r:Math.random()*1.5+0.3, twinkle:Math.random()*Math.PI*2
}));

// Mountain data
const mtnFar = Array.from({length:8},(_,i)=>({
  x: i*(C.width/6), h: 60+Math.random()*70
}));
const mtnNear = Array.from({length:10},(_,i)=>({
  x: i*(C.width/7), h: 35+Math.random()*45
}));
const trees = Array.from({length:14},(_,i)=>({
  x: i*(C.width/9), h: 28+Math.random()*30, w:14+Math.random()*10
}));

let bgOffsets = {far:0, mid:0, near:0, ground:0};

function drawBG(score, frame) {
  const sky = getSkyColors(score);
  const night = score>=60;

  // Sky
  const sg = cx.createLinearGradient(0,0,0,GY);
  sg.addColorStop(0, sky.top); sg.addColorStop(1, sky.bot);
  cx.fillStyle=sg; cx.fillRect(0,0,C.width,GY);

  // Stars (night)
  if(night){
    stars.forEach(s=>{
      const tw=0.5+0.5*Math.sin(frame*0.05+s.twinkle);
      cx.globalAlpha=tw*0.9; cx.fillStyle='#fff';
      cx.beginPath(); cx.arc(s.x,s.y,s.r,0,Math.PI*2); cx.fill();
    });
    cx.globalAlpha=1;
  }

  // Far mountains
  const fc = night?'#1a1a4e': (score<40?'#90CAF9':'#CE93D8');
  cx.fillStyle=fc;
  mtnFar.forEach(m=>{
    const ox=((m.x - bgOffsets.far*0.3)%C.width+C.width)%C.width;
    drawMountain(ox, GY, m.h*1.1, 90);
    drawMountain(ox-C.width, GY, m.h*1.1, 90);
  });

  // Near mountains / hills
  const nc = night?'#0d2a0d':(score<40?'#66BB6A':'#E57373');
  cx.fillStyle=nc;
  mtnNear.forEach(m=>{
    const ox=((m.x - bgOffsets.mid*0.6)%C.width+C.width)%C.width;
    drawMountain(ox, GY, m.h, 65);
    drawMountain(ox-C.width, GY, m.h, 65);
  });

  // Trees silhouette
  const tc = night?'#071a07':'#2E7D32';
  cx.fillStyle=tc;
  trees.forEach(t=>{
    const ox=((t.x - bgOffsets.near)%C.width+C.width)%C.width;
    drawTree(ox, GY-2, t.h, t.w);
    drawTree(ox-C.width, GY-2, t.h, t.w);
  });

  // Grass top
  cx.fillStyle=night?'#1b3a1b':'#558B2F';
  cx.fillRect(0,GY,C.width,8);
  cx.fillStyle=night?'#2a5a2a':'#7CB342';
  for(let i=0;i<C.width+40;i+=40){
    const ox=((i-bgOffsets.ground%40)+C.width)%(C.width+40)-40;
    cx.fillRect(ox,GY,20,5);
  }
  // Dirt
  const dg=cx.createLinearGradient(0,GY+8,0,C.height);
  dg.addColorStop(0, night?'#3e2723':'#6D4C41');
  dg.addColorStop(1, night?'#1a0a00':'#3E2723');
  cx.fillStyle=dg; cx.fillRect(0,GY+8,C.width,C.height-GY-8);
}

function drawMountain(x,y,h,w){
  cx.beginPath(); cx.moveTo(x-w,y); cx.lineTo(x,y-h); cx.lineTo(x+w,y); cx.closePath(); cx.fill();
}
function drawTree(x,y,h,w){
  // trunk
  cx.fillRect(x-3, y-h*0.35, 6, h*0.35);
  // canopy layers
  cx.beginPath(); cx.moveTo(x-w/2,y-h*0.35); cx.lineTo(x,y-h); cx.lineTo(x+w/2,y-h*0.35); cx.closePath(); cx.fill();
  cx.beginPath(); cx.moveTo(x-w*0.4,y-h*0.55); cx.lineTo(x,y-h*1.15); cx.lineTo(x+w*0.4,y-h*0.55); cx.closePath(); cx.fill();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DINO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DINO = {
  x:108, y:GY-65,
  w:48,  h:65,
  vy:0,
  grounded:true,
  lp:0,            // leg phase
  squash:0,        // squash timer (landing)
  stretch:0,       // stretch timer (jumping)

  jump(){
    if(!this.grounded) return;
    this.vy=-17; this.grounded=false; this.stretch=10;
    dustPuff(this.x+this.w*0.3, GY);
    SFX.jump();
  },

  update(){
    this.vy+=0.75; this.y+=this.vy;
    if(this.y>=GY-this.h){
      if(!this.grounded){ dustPuff(this.x+this.w*0.3,GY); SFX.land(); this.squash=8; }
      this.y=GY-this.h; this.vy=0; this.grounded=true;
    }
    if(this.grounded) this.lp+=0.2;
    if(this.squash>0)  this.squash--;
    if(this.stretch>0) this.stretch--;
  },

  draw(invic){
    if(invic>0 && Math.floor(invic/4)%2===1) return;

    let sx=1, sy=1;
    if(this.squash>0){  const t=this.squash/8;  sx=1+0.25*t; sy=1-0.2*t; }
    if(this.stretch>0){ const t=this.stretch/10; sx=1-0.15*t; sy=1+0.2*t; }

    cx.save();
    const pivX=this.x+this.w/2, pivY=this.y+this.h;
    cx.translate(pivX,pivY); cx.scale(sx,sy); cx.translate(-pivX,-pivY);

    const x=this.x, y=this.y;

    // Tail
    cx.fillStyle='#2E7D32';
    cx.beginPath(); cx.moveTo(x+4,y+32); cx.lineTo(x-18,y+52); cx.lineTo(x-10,y+58); cx.lineTo(x+12,y+42); cx.closePath(); cx.fill();

    // Body
    cx.fillStyle='#4CAF50'; cx.fillRect(x+4,y+22,36,34);
    // Belly
    cx.fillStyle='#A5D6A7'; cx.fillRect(x+10,y+28,20,22);
    // Neck
    cx.fillStyle='#4CAF50'; cx.fillRect(x+20,y+16,14,10);
    // Head
    cx.fillRect(x+17,y,30,23);
    // Snout
    cx.fillStyle='#81C784'; cx.fillRect(x+40,y+11,10,12);
    // Nostril
    cx.fillStyle='#2E7D32'; cx.fillRect(x+45,y+13,3,3);
    // Eye white
    cx.fillStyle='#fff'; cx.fillRect(x+31,y+5,11,11);
    // Pupil
    cx.fillStyle='#111'; cx.fillRect(x+33,y+7,7,7);
    // Shine
    cx.fillStyle='#fff'; cx.fillRect(x+38,y+7,2,2);
    // Arm
    cx.fillStyle='#388E3C'; cx.fillRect(x+31,y+24,12,6); cx.fillRect(x+38,y+26,9,4);

    // Legs
    cx.fillStyle='#2E7D32';
    if(this.grounded){
      const a=Math.sin(this.lp)*8, b=Math.sin(this.lp+Math.PI)*8;
      cx.fillRect(x+11,y+54,12,Math.max(4,13+a));
      cx.fillRect(x+27,y+54,12,Math.max(4,13+b));
    } else {
      cx.fillRect(x+11,y+54,12,9);
      cx.fillRect(x+27,y+54,12,9);
    }
    cx.restore();
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  OBSTACLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let obstacles=[];
function spawnObstacle(spd){
  const type=Math.floor(Math.random()*3);
  if(type===0){
    // Short wide rock
    const h=28+Math.random()*22, w=28+Math.random()*20;
    obstacles.push({x:C.width+20,y:GY-h,w,h,speed:spd,passed:false,type:0});
  } else if(type===1){
    // Tall narrow rock
    const h=52+Math.random()*20, w=18+Math.random()*14;
    obstacles.push({x:C.width+20,y:GY-h,w,h,speed:spd,passed:false,type:1});
  } else {
    // Double cluster
    const h1=30+Math.random()*20, w1=20+Math.random()*14;
    const h2=24+Math.random()*18, w2=18+Math.random()*12;
    const gap=6+Math.random()*8;
    obstacles.push({x:C.width+20,     y:GY-h1,w:w1,h:h1,speed:spd,passed:false,type:2});
    obstacles.push({x:C.width+20+w1+gap,y:GY-h2,w:w2,h:h2,speed:spd,passed:false,type:2,paired:true});
  }
}

function drawObstacle(r){
  const {x,y,w,h}=r;
  // Shadow
  cx.fillStyle='rgba(0,0,0,0.2)';
  cx.beginPath(); cx.ellipse(x+w/2,GY+6,w/2+5,5,0,0,Math.PI*2); cx.fill();
  // Rock gradient
  const rg=cx.createLinearGradient(x,y,x+w,y+h);
  rg.addColorStop(0,'#B0BEC5'); rg.addColorStop(0.5,'#78909C'); rg.addColorStop(1,'#455A64');
  cx.fillStyle=rg;
  cx.beginPath();
  cx.moveTo(x+w*0.48,y);
  cx.lineTo(x+w*0.9, y+h*0.3);
  cx.lineTo(x+w,     y+h);
  cx.lineTo(x,       y+h);
  cx.lineTo(x+w*0.08,y+h*0.35);
  cx.closePath(); cx.fill();
  // Highlight
  cx.fillStyle='rgba(255,255,255,0.2)';
  cx.beginPath();
  cx.moveTo(x+w*0.48,y+2); cx.lineTo(x+w*0.76,y+h*0.24); cx.lineTo(x+w*0.3,y+h*0.24);
  cx.closePath(); cx.fill();
  // Crack detail
  cx.strokeStyle='rgba(0,0,0,0.15)'; cx.lineWidth=1;
  cx.beginPath(); cx.moveTo(x+w*0.55,y+h*0.3); cx.lineTo(x+w*0.45,y+h*0.7); cx.stroke();
}

function collides(r){
  const m=9;
  return(
    DINO.x+m       < r.x+r.w &&
    DINO.x+DINO.w-m > r.x+m  &&
    DINO.y+m       < r.y+r.h &&
    DINO.y+DINO.h-m > r.y
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HUD HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rrect(x,y,w,h,r){
  cx.beginPath();
  cx.moveTo(x+r,y); cx.lineTo(x+w-r,y); cx.quadraticCurveTo(x+w,y,x+w,y+r);
  cx.lineTo(x+w,y+h-r); cx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
  cx.lineTo(x+r,y+h); cx.quadraticCurveTo(x,y+h,x,y+h-r);
  cx.lineTo(x,y+r); cx.quadraticCurveTo(x,y,x+r,y); cx.closePath();
}
function heart(cx2,x,y,col){
  cx2.fillStyle=col;
  cx2.beginPath();
  cx2.arc(x-5,y,5.5,Math.PI,0); cx2.arc(x+5,y,5.5,Math.PI,0);
  cx2.lineTo(x,y+12); cx2.closePath(); cx2.fill();
}
function drawHUD(score,lives,hi,combo,level){
  // Score
  cx.fillStyle='rgba(0,0,0,0.4)'; rrect(10,8,140,36,8); cx.fill();
  cx.fillStyle='#FFEB3B'; cx.font='bold 18px "Courier New"';
  cx.fillText(`ì ìˆ˜  ${score}`,20,32);

  // Hi score
  cx.fillStyle='rgba(0,0,0,0.4)'; rrect(C.width/2-70,8,140,36,8); cx.fill();
  cx.fillStyle='#80DEEA'; cx.font='bold 14px "Courier New"';
  cx.textAlign='center';
  cx.fillText(`BEST ${hi}`,C.width/2,22);
  cx.fillStyle='#E0F7FA'; cx.font='bold 12px "Courier New"';
  cx.fillText(`LV.${level}`,C.width/2,36);
  cx.textAlign='left';

  // Lives
  cx.fillStyle='rgba(0,0,0,0.4)'; rrect(C.width-130,8,120,36,8); cx.fill();
  for(let i=0;i<3;i++) heart(cx,C.width-108+i*38,26, i<lives?'#EF5350':'#333');

  // Combo
  if(combo>=3){
    const cc=combo>=10?'#FF6B6B':combo>=6?'#FFD740':'#69F0AE';
    cx.fillStyle='rgba(0,0,0,0.5)'; rrect(10,52,170,28,7); cx.fill();
    cx.fillStyle=cc; cx.font=`bold 16px "Courier New"`;
    cx.fillText(`COMBO Ã—${combo>=10?'MAX':combo>=6?'3':combo>=3?'2':'1'}  ğŸ”¥${combo}`,18,71);
  }
}

function drawScanlines(){
  cx.fillStyle='rgba(0,0,0,0.04)';
  for(let y=0;y<C.height;y+=3) cx.fillRect(0,y,C.width,1);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCREENS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let startAnim=0;
function drawStartScreen(){
  startAnim++;
  // Animated BG
  bgOffsets.ground+=2.5;
  bgOffsets.near+=1.2;
  bgOffsets.mid+=0.6;
  bgOffsets.far+=0.3;
  drawBG(5, startAnim);

  // Walking dino on start screen
  DINO.y=GY-DINO.h; DINO.grounded=true; DINO.lp+=0.15;
  DINO.draw(0);

  cx.fillStyle='rgba(0,0,0,0.52)';
  cx.fillRect(0,0,C.width,C.height);

  // Title
  cx.save(); cx.textAlign='center';
  const pulse=1+0.03*Math.sin(startAnim*0.06);
  cx.translate(C.width/2,0); cx.scale(pulse,pulse); cx.translate(-C.width/2,0);
  cx.fillStyle='#FFD740';
  cx.font='bold 44px "Courier New"';
  cx.fillText('ğŸ¦•  DINO RUSH',C.width/2,85);
  cx.restore();

  cx.textAlign='center';
  cx.fillStyle='#B3E5FC'; cx.font='15px "Courier New"';
  cx.fillText('ë°”ìœ„ë¥¼ ì í”„ë¡œ í”¼í•˜ë©´ +1ì  | ì¶©ëŒí•˜ë©´ ëª©ìˆ¨ -1',C.width/2,132);
  cx.fillText('ì½¤ë³´ë¥¼ ì´ì–´ê°€ë©´ ë°°ìœ¨ ë³´ë„ˆìŠ¤!',C.width/2,156);

  // Start button
  const bp=0.04*Math.sin(startAnim*0.08+1);
  cx.fillStyle=`rgba(67,160,71,${0.85+bp*2})`;
  rrect(C.width/2-130,178,260,52,14); cx.fill();
  cx.fillStyle='#fff'; cx.font='bold 22px "Courier New"';
  cx.fillText('ê²Œì„ ì‹œì‘  â–¶',C.width/2,211);
  cx.textAlign='left';
}

function drawGameOver(score,hi){
  cx.fillStyle='rgba(0,0,0,0.65)';
  cx.fillRect(0,0,C.width,C.height);

  cx.save(); cx.textAlign='center';
  cx.fillStyle='rgba(255,255,255,0.06)'; rrect(C.width/2-210,50,420,210,22); cx.fill();
  cx.strokeStyle='rgba(255,255,255,0.12)'; cx.lineWidth=1.5; cx.stroke();

  cx.fillStyle='#FF5252'; cx.font='bold 46px "Courier New"';
  cx.fillText('GAME OVER',C.width/2,112);

  cx.fillStyle='#FFEB3B'; cx.font='bold 24px "Courier New"';
  cx.fillText(`ìµœì¢… ì ìˆ˜  ${score}ì `,C.width/2,158);
  cx.fillStyle='#80DEEA'; cx.font='16px "Courier New"';
  cx.fillText(`ìµœê³  ê¸°ë¡  ${hi}ì `,C.width/2,185);

  cx.fillStyle='#43A047'; rrect(C.width/2-120,200,240,50,13); cx.fill();
  cx.fillStyle='#fff'; cx.font='bold 21px "Courier New"';
  cx.fillText('ë‹¤ì‹œ ì‹œì‘  â†º',C.width/2,232);
  cx.restore();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let state='start';
let score=0, lives=3, combo=0, level=1;
let invic=0;
let rTimer=0, rInterval=90, baseSpeed=5.4;
let frame=0;
let hi=parseInt(localStorage.getItem('dinohi')||'0');

function levelOf(s){ return Math.floor(s/10)+1; }

function restart(){
  score=0; lives=3; combo=0; level=1; invic=0;
  rTimer=0; rInterval=90; baseSpeed=5.4; frame=0;
  obstacles=[]; particles=[]; floats=[];
  DINO.y=GY-DINO.h; DINO.vy=0; DINO.grounded=true; DINO.lp=0;
  state='play';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UPDATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function update(){
  frame++;

  // Scroll bg
  bgOffsets.ground+= baseSpeed*0.45;
  bgOffsets.near  += baseSpeed*0.22;
  bgOffsets.mid   += baseSpeed*0.1;
  bgOffsets.far   += baseSpeed*0.04;

  DINO.update();
  updateShake(); updateFlash(); updateBanner();
  updateParticles(); updateFloats();
  if(invic>0) invic--;

  // Spawn
  rTimer++;
  if(rTimer>=rInterval){
    spawnObstacle(baseSpeed + score*0.055);
    rTimer=0;
    if(rInterval>50) rInterval-=0.35;
  }

  // Obstacles
  for(let i=obstacles.length-1;i>=0;i--){
    const r=obstacles[i];
    r.x-=r.speed;

    if(!r.passed && r.x+r.w < DINO.x){
      r.passed=true;
      // Only count score for first rock in cluster pair
      if(!r.paired){
        score++;
        combo++;
        SFX.score();
        scorePop(r.x+r.w/2, r.y-10);
        addFloat(r.x+r.w/2, r.y-20, '+1', '#FFD740', 20);

        // Combo announcements
        if(combo===3){ SFX.combo(); addFloat(DINO.x+DINO.w/2,DINO.y-30,'COMBO Ã—2!','#69F0AE',22); }
        if(combo===6){ SFX.combo(); addFloat(DINO.x+DINO.w/2,DINO.y-30,'COMBO Ã—3!','#FF6B6B',24); }
        if(combo===10){ SFX.combo(); addFloat(DINO.x+DINO.w/2,DINO.y-30,'MAX COMBO!','#FF6B6B',26); }

        // Level up
        const nl=levelOf(score);
        if(nl>level){ level=nl; showBanner(`LEVEL ${level} !`); SFX.levelup(); baseSpeed+=0.3; }
      }
    }

    // Collision
    if(!r.passed && invic===0 && collides(r)){
      lives--;
      combo=0;
      invic=65;
      doShake(7,14); doFlash(0.45);
      rockDebris(r.x+r.w/2, r.y+r.h/2);
      SFX.hit();
      obstacles.splice(i,1);
      if(lives<=0){
        lives=0;
        if(score>hi){ hi=score; localStorage.setItem('dinohi',hi); }
        SFX.over();
        state='over';
      }
      continue;
    }
    if(r.x+r.w<0) obstacles.splice(i,1);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DRAW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function draw(){
  cx.save();
  cx.translate(shake.x, shake.y);

  cx.clearRect(-10,-10,C.width+20,C.height+20);
  drawBG(score, frame);
  obstacles.forEach(drawObstacle);
  drawParticles();
  DINO.draw(invic);
  drawHUD(score,lives,hi,combo,level);
  drawFloats();
  drawScanlines();

  // Flash overlay on hit
  if(flash.a>0){
    cx.fillStyle=`rgba(255,80,80,${flash.a})`;
    cx.fillRect(0,0,C.width,C.height);
  }

  // Level banner
  if(banner.timer>0){
    cx.save(); cx.textAlign='center';
    cx.globalAlpha=banner.a;
    cx.fillStyle='rgba(0,0,0,0.6)'; rrect(C.width/2-160,115,320,52,12); cx.fill();
    cx.fillStyle='#FFEB3B';
    cx.font=`bold 32px "Courier New"`;
    cx.save(); cx.translate(C.width/2,148); cx.scale(banner.scale,banner.scale); cx.translate(-C.width/2,-148);
    cx.fillText(banner.text,C.width/2,148); cx.restore();
    cx.globalAlpha=1; cx.restore();
  }

  cx.restore();

  if(state==='over') drawGameOver(score,hi);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INPUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getPos(e){
  const r=C.getBoundingClientRect();
  const cl=e.touches?e.touches[0]:e;
  return {
    x:(cl.clientX-r.left)*(C.width/r.width),
    y:(cl.clientY-r.top)*(C.height/r.height)
  };
}
function onAction(x,y){
  if(state==='start'){ state='play'; return; }
  if(state==='play' ){ DINO.jump(); return; }
  if(state==='over'){
    const bx=C.width/2-120, by=200;
    if(x>=bx&&x<=bx+240&&y>=by&&y<=by+50) restart();
  }
}
document.addEventListener('keydown',e=>{
  if(e.code==='Space'||e.code==='ArrowUp'){
    e.preventDefault();
    if(state==='start') state='play';
    else if(state==='play') DINO.jump();
    else if(state==='over') restart();
  }
});
C.addEventListener('click',     e=>{ const p=getPos(e); onAction(p.x,p.y); });
C.addEventListener('touchstart',e=>{ e.preventDefault(); const p=getPos(e); onAction(p.x,p.y); },{passive:false});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAME LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function loop(){
  if(state==='start') drawStartScreen();
  else { if(state==='play') update(); draw(); }
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
